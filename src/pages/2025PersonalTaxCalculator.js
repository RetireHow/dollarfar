// 2025 Personal Tax Calculator Replica
// This function replicates the EY 2025 Personal Tax Calculator based on data from EY rate cards as of June 1, 2025 (or closest available).
// Input: taxableIncome (number) - assumed to be ordinary taxable income.
// Output: Object with 'results' array containing objects for each province/territory.
// Assumptions: Only basic personal credit included; no other credits, premiums, or levies.
// Calculations use combined federal-provincial marginal brackets for tax payable computation.

function calculate2025PersonalTax(taxableIncome) {
  if (taxableIncome < 0) return { error: "Income must be non-negative." };

  const provinces = [
    {
      key: "bc",
      name: "British Columbia B.C.",
      brackets: [
        {
          from: 0,
          to: 16129,
          ordinary: 0.0,
          cg: 0.0,
          eligible: 0.0,
          ineligible: 0.0,
        },
        {
          from: 16130,
          to: 24039,
          ordinary: 14.5,
          cg: 0.0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 24040,
          to: 25020,
          ordinary: 19.56,
          cg: 0.0,
          eligible: 9.86,
          ineligible: 9.78,
        },
        {
          from: 25021,
          to: 40807,
          ordinary: 23.12,
          cg: 0.0,
          eligible: 13.95,
          ineligible: 11.56,
        },
        {
          from: 40808,
          to: 49279,
          ordinary: 19.56,
          cg: 0.0,
          eligible: 9.86,
          ineligible: 9.78,
        },
        {
          from: 49280,
          to: 57375,
          ordinary: 22.2,
          cg: 0.0,
          eligible: 12.9,
          ineligible: 11.1,
        },
        {
          from: 57376,
          to: 98560,
          ordinary: 28.2,
          cg: 7.56,
          eligible: 19.8,
          ineligible: 14.1,
        },
        {
          from: 98561,
          to: 113158,
          ordinary: 31.0,
          cg: 7.56,
          eligible: 23.02,
          ineligible: 15.5,
        },
        {
          from: 113159,
          to: 114750,
          ordinary: 32.79,
          cg: 7.96,
          eligible: 25.07,
          ineligible: 16.4,
        },
        {
          from: 114751,
          to: 137407,
          ordinary: 38.29,
          cg: 15.55,
          eligible: 31.4,
          ineligible: 19.15,
        },
        {
          from: 137408,
          to: 177882,
          ordinary: 40.7,
          cg: 18.88,
          eligible: 34.17,
          ineligible: 20.35,
        },
        {
          from: 177883,
          to: 186306,
          ordinary: 44.01,
          cg: 23.44,
          eligible: 37.97,
          ineligible: 22.0,
        },
        {
          from: 186307,
          to: 253414,
          ordinary: 46.11,
          cg: 26.34,
          eligible: 40.39,
          ineligible: 23.05,
        },
        {
          from: 253415,
          to: 259829,
          ordinary: 49.8,
          cg: 31.44,
          eligible: 44.64,
          ineligible: 24.9,
        },
        {
          from: 259830,
          to: null,
          ordinary: 53.5,
          cg: 36.54,
          eligible: 48.89,
          ineligible: 26.75,
        },
      ],
    },
    {
      key: "alta",
      name: "Alberta Alta.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 22323,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 22324,
          to: 57375,
          ordinary: 22.5,
          cg: 0,
          eligible: 12.98,
          ineligible: 11.25,
        },
        {
          from: 57376,
          to: 60000,
          ordinary: 28.5,
          cg: 7.56,
          eligible: 19.88,
          ineligible: 14.25,
        },
        {
          from: 60001,
          to: 114750,
          ordinary: 30.5,
          cg: 10.16,
          eligible: 22.18,
          ineligible: 15.25,
        },
        {
          from: 114751,
          to: 151234,
          ordinary: 36,
          cg: 17.75,
          eligible: 28.5,
          ineligible: 18,
        },
        {
          from: 151235,
          to: 177882,
          ordinary: 38,
          cg: 20.51,
          eligible: 30.8,
          ineligible: 19,
        },
        {
          from: 177883,
          to: 181481,
          ordinary: 41.31,
          cg: 25.07,
          eligible: 34.61,
          ineligible: 20.65,
        },
        {
          from: 181482,
          to: 241974,
          ordinary: 42.31,
          cg: 26.45,
          eligible: 35.76,
          ineligible: 21.15,
        },
        {
          from: 241975,
          to: 253414,
          ordinary: 43.31,
          cg: 27.83,
          eligible: 36.91,
          ineligible: 21.65,
        },
        {
          from: 253415,
          to: 362961,
          ordinary: 47,
          cg: 32.93,
          eligible: 41.15,
          ineligible: 23.5,
        },
        {
          from: 362962,
          to: null,
          ordinary: 48,
          cg: 34.31,
          eligible: 42.3,
          ineligible: 24,
        },
      ],
    },
    {
      key: "sask",
      name: "Saskatchewan Sask.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 19491,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 19492,
          to: 53463,
          ordinary: 25,
          cg: 0,
          eligible: 15.47,
          ineligible: 12.5,
        },
        {
          from: 53464,
          to: 57375,
          ordinary: 27,
          cg: 2.07,
          eligible: 17.77,
          ineligible: 13.5,
        },
        {
          from: 57376,
          to: 114750,
          ordinary: 33,
          cg: 9.63,
          eligible: 24.67,
          ineligible: 16.5,
        },
        {
          from: 114751,
          to: 152750,
          ordinary: 38.5,
          cg: 17.22,
          eligible: 30.99,
          ineligible: 19.25,
        },
        {
          from: 152751,
          to: 177882,
          ordinary: 40.5,
          cg: 19.98,
          eligible: 33.29,
          ineligible: 20.25,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 43.81,
          cg: 24.54,
          eligible: 37.09,
          ineligible: 21.9,
        },
        {
          from: 253415,
          to: null,
          ordinary: 47.5,
          cg: 29.64,
          eligible: 41.34,
          ineligible: 23.75,
        },
      ],
    },
    {
      key: "man",
      name: "Manitoba Man.",
      brackets: [
        { from: 0, to: 15780, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 15781,
          to: 16129,
          ordinary: 10.8,
          cg: 3.86,
          eligible: 11.52,
          ineligible: 5.4,
        },
        {
          from: 16130,
          to: 47000,
          ordinary: 25.3,
          cg: 3.86,
          eligible: 17.81,
          ineligible: 12.65,
        },
        {
          from: 47001,
          to: 57375,
          ordinary: 27.25,
          cg: 6.56,
          eligible: 20.05,
          ineligible: 13.63,
        },
        {
          from: 57376,
          to: 100000,
          ordinary: 33.25,
          cg: 14.12,
          eligible: 26.95,
          ineligible: 16.63,
        },
        {
          from: 100001,
          to: 114750,
          ordinary: 37.9,
          cg: 20.53,
          eligible: 32.3,
          ineligible: 18.95,
        },
        {
          from: 114751,
          to: 177882,
          ordinary: 43.4,
          cg: 28.12,
          eligible: 38.62,
          ineligible: 21.7,
        },
        {
          from: 177883,
          to: 200000,
          ordinary: 46.71,
          cg: 32.69,
          eligible: 42.43,
          ineligible: 23.35,
        },
        {
          from: 200001,
          to: 253414,
          ordinary: 47.56,
          cg: 33.86,
          eligible: 43.41,
          ineligible: 23.78,
        },
        {
          from: 253415,
          to: 400000,
          ordinary: 51.25,
          cg: 38.96,
          eligible: 47.65,
          ineligible: 25.63,
        },
        {
          from: 400001,
          to: null,
          ordinary: 50.4,
          cg: 37.78,
          eligible: 46.67,
          ineligible: 25.2,
        },
      ],
    },
    {
      key: "ont",
      name: "Ontario Ont.",
      brackets: [
        {
          from: 0,
          to: 16129,
          ordinary: 0.0,
          cg: 0.0,
          eligible: 0.0,
          ineligible: 0.0,
        },
        {
          from: 16130,
          to: 18569,
          ordinary: 14.5,
          cg: 0.0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 18570,
          to: 24391,
          ordinary: 24.6,
          cg: 0.0,
          eligible: 11.04,
          ineligible: 12.3,
        },
        {
          from: 24392,
          to: 52886,
          ordinary: 19.55,
          cg: 0.0,
          eligible: 8.66,
          ineligible: 9.78,
        },
        {
          from: 52887,
          to: 57375,
          ordinary: 23.65,
          cg: 0.0,
          eligible: 13.38,
          ineligible: 11.83,
        },
        {
          from: 57376,
          to: 93137,
          ordinary: 29.65,
          cg: 7.56,
          eligible: 20.28,
          ineligible: 14.83,
        },
        {
          from: 93138,
          to: 105775,
          ordinary: 31.48,
          cg: 8.92,
          eligible: 22.38,
          ineligible: 15.74,
        },
        {
          from: 105776,
          to: 109723,
          ordinary: 33.89,
          cg: 12.24,
          eligible: 25.16,
          ineligible: 16.95,
        },
        {
          from: 109724,
          to: 114750,
          ordinary: 37.91,
          cg: 17.79,
          eligible: 29.78,
          ineligible: 18.95,
        },
        {
          from: 114751,
          to: 150000,
          ordinary: 43.41,
          cg: 25.38,
          eligible: 36.1,
          ineligible: 21.7,
        },
        {
          from: 150001,
          to: 177882,
          ordinary: 44.97,
          cg: 27.53,
          eligible: 37.9,
          ineligible: 22.48,
        },
        {
          from: 177883,
          to: 220000,
          ordinary: 48.28,
          cg: 32.09,
          eligible: 41.7,
          ineligible: 24.14,
        },
        {
          from: 220001,
          to: 253414,
          ordinary: 49.84,
          cg: 34.25,
          eligible: 43.49,
          ineligible: 24.92,
        },
        {
          from: 253415,
          to: null,
          ordinary: 53.53,
          cg: 39.34,
          eligible: 47.74,
          ineligible: 26.76,
        },
      ],
    },
    {
      key: "que",
      name: "Quebec Que.",
      brackets: [
        {
          from: 0,
          to: 16129,
          ordinary: 0.0,
          cg: 0.0,
          eligible: 0.0,
          ineligible: 0.0,
        },
        {
          from: 16130,
          to: 18571,
          ordinary: 12.53,
          cg: 5.73,
          eligible: 0.0,
          ineligible: 6.26,
        },
        {
          from: 18572,
          to: 53255,
          ordinary: 14.0,
          cg: 17.9,
          eligible: 3.17,
          ineligible: 13.26,
        },
        {
          from: 53256,
          to: 57375,
          ordinary: 19.0,
          cg: 23.65,
          eligible: 10.07,
          ineligible: 15.76,
        },
        {
          from: 57376,
          to: 106495,
          ordinary: 19.0,
          cg: 28.93,
          eligible: 16.39,
          ineligible: 18.06,
        },
        {
          from: 106496,
          to: 114750,
          ordinary: 24.0,
          cg: 34.68,
          eligible: 23.29,
          ineligible: 20.56,
        },
        {
          from: 114751,
          to: 129590,
          ordinary: 24.0,
          cg: 39.96,
          eligible: 29.63,
          ineligible: 22.86,
        },
        {
          from: 129591,
          to: 177882,
          ordinary: 25.75,
          cg: 41.97,
          eligible: 32.04,
          ineligible: 23.73,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 24.48,
          cg: 45.16,
          eligible: 35.86,
          ineligible: 25.11,
        },
        {
          from: 253415,
          to: null,
          ordinary: 27.56,
          cg: 48.7,
          eligible: 40.11,
          ineligible: 26.65,
        },
      ],
    },
    {
      key: "nb",
      name: "New Brunswick N.B.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 21920,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 21921,
          to: 48620,
          ordinary: 26.9,
          cg: 0,
          eligible: 17.39,
          ineligible: 13.45,
        },
        {
          from: 48621,
          to: 51306,
          ordinary: 23.9,
          cg: 0,
          eligible: 13.94,
          ineligible: 11.95,
        },
        {
          from: 51307,
          to: 57375,
          ordinary: 28.5,
          cg: 0,
          eligible: 19.23,
          ineligible: 14.25,
        },
        {
          from: 57376,
          to: 102614,
          ordinary: 34.5,
          cg: 7.56,
          eligible: 26.13,
          ineligible: 17.25,
        },
        {
          from: 102615,
          to: 114750,
          ordinary: 36.5,
          cg: 10.32,
          eligible: 28.43,
          ineligible: 18.25,
        },
        {
          from: 114751,
          to: 177882,
          ordinary: 42,
          cg: 17.91,
          eligible: 34.75,
          ineligible: 21,
        },
        {
          from: 177883,
          to: 190060,
          ordinary: 45.31,
          cg: 22.47,
          eligible: 38.55,
          ineligible: 22.65,
        },
        {
          from: 190061,
          to: 253414,
          ordinary: 48.81,
          cg: 27.3,
          eligible: 42.58,
          ineligible: 24.4,
        },
        {
          from: 253415,
          to: null,
          ordinary: 52.5,
          cg: 32.4,
          eligible: 46.83,
          ineligible: 26.25,
        },
      ],
    },
    {
      key: "ns",
      name: "Nova Scotia N.S.",
      brackets: [
        {
          from: 0,
          to: 15100,
          ordinary: 0.0,
          cg: 0.0,
          eligible: 0.0,
          ineligible: 0.0,
        },
        {
          from: 15101,
          to: 16129,
          ordinary: 13.79,
          cg: 6.82,
          eligible: 14.13,
          ineligible: 6.9,
        },
        {
          from: 16130,
          to: 21000,
          ordinary: 28.29,
          cg: 6.82,
          eligible: 20.42,
          ineligible: 14.15,
        },
        {
          from: 21001,
          to: 30507,
          ordinary: 23.29,
          cg: 0.0,
          eligible: 14.67,
          ineligible: 11.65,
        },
        {
          from: 30508,
          to: 57375,
          ordinary: 29.45,
          cg: 8.42,
          eligible: 21.76,
          ineligible: 14.73,
        },
        {
          from: 57376,
          to: 61015,
          ordinary: 35.45,
          cg: 15.98,
          eligible: 28.66,
          ineligible: 17.73,
        },
        {
          from: 61016,
          to: 95883,
          ordinary: 37.17,
          cg: 18.35,
          eligible: 30.64,
          ineligible: 18.59,
        },
        {
          from: 95884,
          to: 114750,
          ordinary: 38.0,
          cg: 19.5,
          eligible: 31.59,
          ineligible: 19.0,
        },
        {
          from: 114751,
          to: 154650,
          ordinary: 43.5,
          cg: 27.09,
          eligible: 37.92,
          ineligible: 21.75,
        },
        {
          from: 154651,
          to: 177882,
          ordinary: 47.0,
          cg: 31.92,
          eligible: 41.94,
          ineligible: 23.5,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 50.31,
          cg: 36.49,
          eligible: 45.75,
          ineligible: 25.16,
        },
        {
          from: 253415,
          to: null,
          ordinary: 54.0,
          cg: 41.58,
          eligible: 49.99,
          ineligible: 27.0,
        },
      ],
    },
    {
      key: "pei",
      name: "Prince Edward Island P.E.I.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 18334,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 18335,
          to: 22650,
          ordinary: 24,
          cg: 0,
          eligible: 15.72,
          ineligible: 12,
        },
        {
          from: 22651,
          to: 29650,
          ordinary: 29,
          cg: 5.52,
          eligible: 21.47,
          ineligible: 14.5,
        },
        {
          from: 29651,
          to: 33328,
          ordinary: 24,
          cg: 0,
          eligible: 15.72,
          ineligible: 12,
        },
        {
          from: 33329,
          to: 57375,
          ordinary: 27.97,
          cg: 4.1,
          eligible: 20.28,
          ineligible: 13.99,
        },
        {
          from: 57376,
          to: 64656,
          ordinary: 33.97,
          cg: 11.66,
          eligible: 27.18,
          ineligible: 16.99,
        },
        {
          from: 64657,
          to: 105000,
          ordinary: 37.1,
          cg: 15.98,
          eligible: 30.78,
          ineligible: 18.55,
        },
        {
          from: 105001,
          to: 114750,
          ordinary: 38.12,
          cg: 17.39,
          eligible: 31.95,
          ineligible: 19.06,
        },
        {
          from: 114751,
          to: 140000,
          ordinary: 43.62,
          cg: 24.98,
          eligible: 38.28,
          ineligible: 21.81,
        },
        {
          from: 140001,
          to: 177882,
          ordinary: 45,
          cg: 26.88,
          eligible: 39.87,
          ineligible: 22.5,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 48.31,
          cg: 31.44,
          eligible: 43.67,
          ineligible: 24.15,
        },
        {
          from: 253415,
          to: null,
          ordinary: 52,
          cg: 36.54,
          eligible: 47.92,
          ineligible: 26,
        },
      ],
    },
    {
      key: "nl",
      name: "Newfoundland and Labrador N.L.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 22527,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 22528,
          to: 23928,
          ordinary: 23.2,
          cg: 3.31,
          eligible: 12.62,
          ineligible: 11.6,
        },
        {
          from: 23929,
          to: 30159,
          ordinary: 39.2,
          cg: 25.39,
          eligible: 31.02,
          ineligible: 19.6,
        },
        {
          from: 30160,
          to: 44192,
          ordinary: 23.2,
          cg: 3.31,
          eligible: 12.62,
          ineligible: 11.6,
        },
        {
          from: 44193,
          to: 57375,
          ordinary: 29,
          cg: 11.32,
          eligible: 19.29,
          ineligible: 14.5,
        },
        {
          from: 57376,
          to: 88382,
          ordinary: 35,
          cg: 18.88,
          eligible: 26.19,
          ineligible: 17.5,
        },
        {
          from: 88383,
          to: 114750,
          ordinary: 36.3,
          cg: 20.67,
          eligible: 27.68,
          ineligible: 18.15,
        },
        {
          from: 114751,
          to: 157792,
          ordinary: 41.8,
          cg: 28.26,
          eligible: 34.01,
          ineligible: 20.9,
        },
        {
          from: 157793,
          to: 177882,
          ordinary: 43.8,
          cg: 31.02,
          eligible: 36.31,
          ineligible: 21.9,
        },
        {
          from: 177883,
          to: 220910,
          ordinary: 47.11,
          cg: 35.58,
          eligible: 40.11,
          ineligible: 23.55,
        },
        {
          from: 220911,
          to: 253414,
          ordinary: 49.11,
          cg: 38.34,
          eligible: 42.41,
          ineligible: 24.55,
        },
        {
          from: 253415,
          to: 282214,
          ordinary: 52.8,
          cg: 43.44,
          eligible: 46.66,
          ineligible: 26.4,
        },
        {
          from: 282215,
          to: 564429,
          ordinary: 53.8,
          cg: 44.82,
          eligible: 47.81,
          ineligible: 26.9,
        },
        {
          from: 564430,
          to: 1128858,
          ordinary: 54.3,
          cg: 45.51,
          eligible: 48.38,
          ineligible: 27.15,
        },
        {
          from: 1128859,
          to: null,
          ordinary: 54.8,
          cg: 46.2,
          eligible: 48.96,
          ineligible: 27.4,
        },
      ],
    },
    {
      key: "nwt",
      name: "Northwest Territories N.W.T.",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 17842,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 17843,
          to: 51964,
          ordinary: 20.4,
          cg: 0,
          eligible: 6.29,
          ineligible: 10.2,
        },
        {
          from: 51965,
          to: 57375,
          ordinary: 23.1,
          cg: 0,
          eligible: 9.28,
          ineligible: 11.55,
        },
        {
          from: 57376,
          to: 103930,
          ordinary: 29.1,
          cg: 7.56,
          eligible: 16.18,
          ineligible: 14.55,
        },
        {
          from: 103931,
          to: 114750,
          ordinary: 32.7,
          cg: 8.53,
          eligible: 20.32,
          ineligible: 16.35,
        },
        {
          from: 114751,
          to: 168967,
          ordinary: 38.2,
          cg: 16.12,
          eligible: 26.65,
          ineligible: 19.1,
        },
        {
          from: 168968,
          to: 177882,
          ordinary: 40.05,
          cg: 18.67,
          eligible: 28.77,
          ineligible: 20.03,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 43.36,
          cg: 23.23,
          eligible: 32.57,
          ineligible: 21.68,
        },
        {
          from: 253415,
          to: null,
          ordinary: 47.05,
          cg: 28.33,
          eligible: 36.82,
          ineligible: 23.53,
        },
      ],
    },
    {
      key: "yukon",
      name: "Yukon",
      brackets: [
        {
          from: 0,
          to: 16129,
          ordinary: 0.0,
          cg: 0.0,
          eligible: 0.0,
          ineligible: 0.0,
        },
        {
          from: 16130,
          to: 57375,
          ordinary: 20.9,
          cg: 0.0,
          eligible: 12.88,
          ineligible: 10.45,
        },
        {
          from: 57376,
          to: 114750,
          ordinary: 29.5,
          cg: 7.56,
          eligible: 22.77,
          ineligible: 14.75,
        },
        {
          from: 114751,
          to: 177882,
          ordinary: 36.9,
          cg: 15.15,
          eligible: 31.28,
          ineligible: 18.45,
        },
        {
          from: 177883,
          to: 253414,
          ordinary: 42.24,
          cg: 20.97,
          eligible: 37.43,
          ineligible: 21.12,
        },
        {
          from: 253415,
          to: 500000,
          ordinary: 45.8,
          cg: 25.89,
          eligible: 41.52,
          ineligible: 22.9,
        },
        {
          from: 500001,
          to: null,
          ordinary: 48.0,
          cg: 28.92,
          eligible: 44.05,
          ineligible: 24.0,
        },
      ],
    },
    {
      key: "nu",
      name: "Nunavut",
      brackets: [
        { from: 0, to: 16129, ordinary: 0, cg: 0, eligible: 0, ineligible: 0 },
        {
          from: 16130,
          to: 19274,
          ordinary: 14.5,
          cg: 0,
          eligible: 6.29,
          ineligible: 7.25,
        },
        {
          from: 19275,
          to: 54707,
          ordinary: 18.5,
          cg: 0,
          eligible: 7.89,
          ineligible: 9.25,
        },
        {
          from: 54708,
          to: 57375,
          ordinary: 21.5,
          cg: 2.06,
          eligible: 11.34,
          ineligible: 10.75,
        },
        {
          from: 57376,
          to: 109413,
          ordinary: 27.5,
          cg: 9.62,
          eligible: 18.24,
          ineligible: 13.75,
        },
        {
          from: 109414,
          to: 114750,
          ordinary: 29.5,
          cg: 12.38,
          eligible: 20.54,
          ineligible: 14.75,
        },
        {
          from: 114751,
          to: 177881,
          ordinary: 35,
          cg: 19.97,
          eligible: 26.87,
          ineligible: 17.5,
        },
        {
          from: 177882,
          to: 253414,
          ordinary: 40.81,
          cg: 27.98,
          eligible: 33.54,
          ineligible: 20.4,
        },
        {
          from: 253415,
          to: null,
          ordinary: 44.5,
          cg: 33.08,
          eligible: 37.79,
          ineligible: 22.25,
        },
      ],
    },
  ];

  const results = [];

  for (let prov of provinces) {
    // Calculate tax payable using ordinary rates
    let tax = 0;
    let prevUpper = 0;
    for (let bracket of prov.brackets) {
      const from = bracket.from;
      const to = bracket.to !== null ? bracket.to : Infinity;
      if (taxableIncome > prevUpper) {
        const sliceStart = Math.max(prevUpper, from);
        const sliceEnd = Math.min(taxableIncome, to);
        if (sliceStart < sliceEnd) {
          tax += (sliceEnd - sliceStart) * (bracket.ordinary / 100);
        }
      }
      prevUpper = to;
      if (taxableIncome <= to) break;
    }

    // Find current bracket for marginal rates
    let currentBracket =
      prov.brackets.find(
        (b) =>
          taxableIncome >= b.from && (b.to === null || taxableIncome <= b.to)
      ) || prov.brackets[prov.brackets.length - 1];

    let afterTax = taxableIncome - tax;
    let avgRate = taxableIncome > 0 ? (tax / taxableIncome) * 100 : 0;

    results.push({
      province: prov.name,
      taxPayable: Math.round(tax * 100) / 100,
      afterTaxIncome: Math.round(afterTax * 100) / 100,
      averageTaxRate: Math.round(avgRate * 100) / 100,
      marginalTaxRate: currentBracket.ordinary,
      marginalRateOnCapitalGains: currentBracket.cg,
      marginalRateOnEligibleDividends: currentBracket.eligible,
      marginalRateOnIneligibleDividends: currentBracket.ineligible,
    });
  }

  return { results };
}

// Example usage:
const result = calculate2025PersonalTax(16000);
console.log(result);
